<aura:component controller="eBc_RecurringController" implements="flexipage:availableForAllPageTypes" access="global">
    <aura:attribute name="parentComp" type="Aura.Component" required="true" />
    <aura:attribute name="Settings" type="Object" required="true" />
    <aura:attribute name="TaxTitle" type="String" required="true" />
    <aura:attribute name="Spinner" type="boolean" default="false" />
    <aura:attribute type="String" name="sortField" />
    <aura:attribute type="Boolean" name="sortAsc" default="false" />
    <aura:attribute type="Integer" name="pageNumber" default="1" />
    <aura:attribute type="Integer" name="maxPage" default="1" />
    <aura:attribute name="selectedLookUpAccRecord" type="sObject" default="{}" access="public" />
    <aura:attribute name="filterStatus" type="List" />
    <aura:attribute name="rrStatus" type="string" default="" />
    <aura:attribute name="scheduledRecurring" type="List" />
    <aura:attribute name="previewDetails" type="boolean" default="false" />
    <aura:attribute name="isOpenScheduleDatesModal" type="boolean" default="false" />
    <aura:attribute name="RecurIndefinitely" type="boolean" default="false" />
    <aura:attribute name="EndDateIsRequired" type="boolean" default="true" />
    <aura:attribute name="accDetail" type="sObject" />
    <aura:attribute name="custDetail" type="EBizCharge_Fields_Config__c" />
    <aura:attribute name="ConDetail" type="sObject" />
    <aura:attribute name="isOpen" type="boolean" default="false" />
    <aura:attribute name="rrPayName" type="string" default="" />
    <aura:attribute name="Object_Name" type="string" default="" />
    <aura:attribute name="rrStartDate" type="date" default="" />
    <aura:attribute name="rrEndDate" type="date" default="" />
    <aura:attribute name="rrIndefinitely" type="boolean" default="false" />
    <aura:attribute name="rrAmountTotal" type="double" default="0.0" />
    <aura:attribute name="rrAmount" type="double" default="" />
    <aura:attribute name="rrTax" type="string" default="0.0" />
    <aura:attribute name="ExcludeTax" type="boolean" default="false" />
    <aura:attribute name="rrFrequency" type="string" default="" />
    <aura:attribute name="rrOptions" type="List" />
    <aura:attribute name="rrNotes" type="string" default="" />
    <aura:attribute name="payByCardInfo" type="sObject" default="{}" />
    <aura:attribute name="saveCardsList" type="List" default="" required="true" />
    <aura:attribute name="saveCard" type="Boolean" default="true" />
    <aura:attribute name="saveACHList" type="List" />
    <aura:attribute name="rrS" type="sObject" default="{}" />
    <aura:attribute name="NewrrS" type="sObject" default="{}" />
    <aura:attribute name="ChieldActiveTab" type="string" default="" />
    <aura:attribute name="selectedCardXC" type="string" default="" />
    <aura:attribute name="cvcXC" type="Integer" default="" />
    <aura:attribute name="SendReceiptToXC" type="Boolean" default="false" />
    <aura:attribute name="SendReceiptToAddCard" type="Boolean" default="false" />
    <aura:attribute name="addEmailsXC" type="String" default="" />
    <aura:attribute name="CardNumber" type="Integer" default="" />
    <aura:attribute name="BillingAddress" type="String" default="" />
    <aura:attribute name="expiryMonth" type="Integer" default="" />
    <aura:attribute name="expiryYear" type="Integer" default="" />
    <aura:attribute name="CVCNumber" type="Integer" default="" />
    <aura:attribute name="ZipCode" type="Integer" default="" />
    <aura:attribute name="CardHolderName" type="String" default="" />
    <aura:attribute name="SendReceiptTo" type="Boolean" default="false" />
    <aura:attribute name="addCardEmail" type="String" default="" />
    <aura:attribute name="monthList" type="List" />
    <aura:attribute name="yearList" type="List" />
    <aura:attribute name="disableSubmitBtn" type="boolean" default="false" required="true" />
    <aura:handler name="callParentCmpMethod" action="{!c.handleCompEvent}" event="c:ParentEvent" />
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <!-- =====Data table attribute == -->
    <aura:attribute name="DataColumns" type="List" />
    <aura:attribute name="TranscationsData" type="Object" />
    <aura:attribute name="sortBy" type="String" />
    <aura:attribute name="sortDirection" type="String" />
    <aura:attribute name="maxRowSelection" type="Integer" default="50" />
    <aura:attribute name="selectedRowsCount" type="Integer" default="0" />
    <aura:attribute name="loadMoreOffset" type="Integer" default="20" />
    <aura:attribute name="selectedOrders" type="List" />
    <!-- =========== -->
    <aura:attribute name="payByACHInfo" type="sObject" default="{}" />
    <aura:attribute name="ParentActiveTab" type="string" default="PayByACH" />
    <aura:attribute name="pps" type="sObject" required="true" />
    <aura:attribute name="paymentMethodIdSA" type="String" default="" />
    <aura:attribute name="accRoutNumber" type="String" default="" />
    <aura:attribute name="acctypeoptions" type="List" default="[
             {'label': 'Checking', 'value': 'Checking'},
             {'label': 'Savings', 'value': 'Savings'}
             ]" />
    <aura:attribute name="accHolderName" type="String" default="" />
    <aura:attribute name="accNumber" type="String" default="" />
    <aura:attribute name="accType" type="String" default="" />
    <aura:attribute name="addEmails" type="String" default="" />
    <aura:attribute name="MethodName" type="string" default="" />
    <aura:attribute name="SendReceiptToSA" type="Boolean" default="false" />
    <aura:attribute name="contactEmail" type="String" default="" />
    <aura:handler name="change" value="{!v.contactEmail}" action="{!c.contactEmailChange}" />
    <aura:attribute name="addEmailsSA" type="String" default="" />
    <aura:attribute name="placeholderCard" type="string" default="" />
    <aura:attribute name="placeholderACH" type="string" default="" />
    <aura:method name="callChildFields" action="{!c.clearFields}" />
    <aura:attribute name="today" type="Date" />
    <aura:attribute name="mindate" type="date" />
    <aura:attribute name="maxdate" type="date" />
    <aura:attribute name="saveACH" type="Boolean" default="false" />
    <aura:attribute name="placeholderSC" type="string" default="" />
    <aura:attribute name="disableStartDate" type="boolean" />
    <div class="container">
        <!--loading spinner-->
        <aura:if isTrue="{!v.Spinner}">
            <div aura:id="spinnerId" class="slds-spinner_container" style="position: fixed;">
                <lightning:spinner aura:id="Spinner" alternativeText="Loading" size="medium" variant="brand" />
            </div>
        </aura:if>
        <!-- =========== -->
        <div class="slds-grid slds-gutters">
            <div class="slds-col slds-size_1-of-4">
                <div class="slds-form-element slds-form-element_stacked">
                    <c:EBizCharge_CustomLookupRecurring objectAPIName="account" IconName="standard:account"
                        selectedRecord="{!v.selectedLookUpAccRecord}" label="Select an Account / Contact" />
                </div>
            </div>
            <div class="slds-col slds-size_1-of-4">
                <div class="slds-form-element slds-form-element_stacked">
                    <lightning:combobox label="Filter by Status" value="{!v.rrStatus}" placeholder="Choose a status"
                        options="{! v.filterStatus }" onchange="{! c.searchScheduledRR }" />
                </div>
            </div>
        </div>
        <div class="slds-form-element slds-form-element_stacked" style="padding-top: 4px;">
            <h1>Showing scheduled payments
                <lightning:badge label="{!v.selectedRowsCount}" iconName="utility:success" />
            </h1>
        </div>
        <!-- ===== Table Grid ===== -->
        <div class="slds-m-vertical_small">
            <!--Custom Page Content-->
            <div class="slds-grid slds-m-bottom_xx-large">
                <div style="height :800px; width:100%">
                    <aura:renderIf isTrue="{!v.scheduledRecurring.length &gt; 0}">
                        <lightning:datatable aura:id="RecurringTable" keyField="Id" hideCheckboxColumn="false"
                            columns="{!v.DataColumns}" data="{!v.scheduledRecurring}" sortedBy="{!v.sortBy}"
                            sortedDirection="{!v.sortDirection}" loadMoreOffset="{! v.loadMoreOffset }"
                            onsort="{!c.handleSort}" onrowaction="{! c.handleSelectAction }"
                            onrowselection="{! c.updateSelectedText }" />
                        <aura:set attribute="else">
                            <div class="slds-illustration slds-illustration_small">
                                <img src="{!$Resource.EmptyState}" />
                            </div>
                        </aura:set>
                    </aura:renderIf>
                </div>
            </div>
        </div>
        <!-- =========== -->
        <center><i> Date and Time displayed in UTC coordinated universal time clock</i></center>
        <!-- ===== Edit Recurring Modal ===== -->
        <aura:if isTrue="{!v.isOpen}">
            <!--###### MODAL BOX Start######-->
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
            aria-describedby="modal-content-id-1"
            class="slds-modal slds-fade-in-open slds-modal_medium slds-p-top_xx-large slds-m-top_x-large">
            <div class="slds-modal__container slds-Modal-Schedule" style="width: 95%;">
                    <!-- ###### MODAL BOX HEADER Start ######-->
                    <header class="slds-modal__header">
                        <lightning:buttonIcon iconName="utility:close" onclick="{! c.closeModel }"
                            alternativeText="close" variant="bare-inverse" class="slds-modal__close" />
                        <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Edit Scheduled
                            Recurring Payment</h2>
                    </header>
                    <!--###### MODAL BOX BODY Part Start######-->
                <div class="slds-modal__content slds-p-around_large" id="modal-content-id-1">
                        <div class="fieldset slds-form-element slds-form-element_compound">
                            <div class="slds-text-title_bold">Schedule Information</div>
                            <div class="slds-grid slds-gutters slds-m-horizontal_x-large">
                                <div class="slds-col slds-size_1-of-2">
                                    <div class="slds-form-element__row slds-m-vertical_small">
                                        <div class="slds-size_1-of-1">
                                            <div class="slds-form-element">
                                                <lightning:input type="text" aura:id='req-fieldsrr' required="true"
                                                    label="Recurring Payment Name" value="{!v.rrPayName}"
                                                    placeholder="Input payment name..."
                                                    onchange="{!c.validateRecurringForm}" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-form-element__row slds-m-vertical_small">
                                        <div class="slds-size_2-of-3">
                                            <div class="slds-form-element">
                                                <lightning:input type="number" required="true" label="Amount Per Period"
                                                    placeholder="$ Input payment amount..." aura:id="req-fieldsrr"
                                                    value="{!v.rrAmount}" formatter="currency" step="0.01"
                                                    messageWhenBadInput="Input numeric values for amount"
                                                    onchange="{!c.ChangeAmount}"
                                                    messageWhenValueMissing="Required Field" disabled="true" />
                                            </div>
                                        </div>
                                        <div class="slds-size_2-of-6">
                                            <div class="slds-form-element">
                                                <aura:renderIf isTrue="{!v.Settings.Ebiz_C__Show_Tax_Field__c}">
                                                    <lightning:input type="number" name="tax" label="{!v.TaxTitle}"
                                                        disabled="true"
                                                        formatter="{!v.Settings.Ebiz_C__Tax_Manual_Type__c == 'Use Percent' ? 'percent-fixed' : 'currency'}"
                                                        step="0.01" value="{!v.rrTax}" onchange="{!c.ChangeAmount}" />

                                                </aura:renderIf>
                                            </div>
                                        </div>
                                        <div class=" slds-size_2-of-6" role="listitem">
                                            <div class="slds-form-element slds-align-middle" style="width:185px">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-form-element__row slds-m-vertical_small">
                                        <div class="slds-size_1-of-1">
                                            <div class="slds-form-element">
                                                <lightning:combobox aura:id='req-fieldsrr' dropdownAlignment="right"
                                                    label="Payment Frequency" placeholder="Choose payment frequency"
                                                    required="true" options="{! v.rrOptions }" value="{!v.rrFrequency}"
                                                    fieldLevelHelp="Field Help" onchange="{!c.validateRecurringForm}"
                                                    disabled="true" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col slds-size_1-of-2" style="padding-left: 21px;">
                                    <div class="slds-form-element__row">
                                        <div class="slds-size_1-of-3">
                                            <div class="slds-form-element">
                                                <lightning:input type="date" dateStyle="short" label="Start Date"
                                                    placeholder="--Select--" required="true" aura:id='req-fieldsrr'
                                                    value="{!v.rrStartDate}" min="{!v.mindate}"
                                                    messageWhenRangeUnderflow="Date must be after today's date"
                                                    onchange="{!c.validateRecurringForm}"
                                                    disabled="{!v.disableStartDate}" />
                                            </div>
                                        </div>
                                        <div class="slds-size_1-of-3">
                                            <div class="slds-form-element">
                                                <aura:if isTrue="{!v.EndDateIsRequired}">
                                                    <lightning:input type="date" dateStyle="short" label="End Date"
                                                        placeholder="--Select--" required="{!v.EndDateIsRequired}"
                                                        aura:id='req-fieldsrr' value="{!v.rrEndDate}" min="{!v.maxdate}"
                                                        messageWhenRangeUnderflow="Date must be after start date"
                                                        disabled="{!v.RecurIndefinitely}"
                                                        onchange="{!c.validateRecurringForm}"
                                                        messageWhenValueMissing="Required Field" />
                                                    <aura:set attribute="else">
                                                        <lightning:input type="date" dateStyle="short" label="End Date"
                                                            placeholder="--Select--" value="{!v.rrEndDate}"
                                                            disabled="{!v.RecurIndefinitely}"
                                                            onchange="{!c.validateRecurringForm}"
                                                            messageWhenValueMissing="Required Field" />
                                                    </aura:set>
                                                </aura:if>
                                            </div>
                                        </div>
                                        <div class="slds-size_1-of-3">
                                            <div class="slds-align-middle slds-m-left_x-small" style="width:130px;">
                                                <ui:inputCheckbox labelClass="slds-float--right" aura:id="checkbox"
                                                    label="Recur Indefinitely" change="{!c.checkRecurIndefinitely}" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-form-element__row slds-m-vertical_small">
                                        <div class="slds-size_1-of-1">
                                            <div class="slds-form-element">
                                                <lightning:textarea label="Notes" placeholder="type here..."
                                                    value="{!v.rrNotes}" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-form-element__row">
                                        <div class="slds-size_1-of-1">
                                            <div class="slds-form-element slds-text-align_right">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="slds-text-title_bold slds-m-top_large">Payment Methods</div>
                        <div class="slds-m-horizontal_x-large">
                            <lightning:tabset selectedTabId="{!v.rrS.tabToActive}">
                                <lightning:tab label="Pay By Card" id="PayByCard">
                                    <lightning:tabset variant="scoped" selectedTabId="UseExistingCard">
                                        <lightning:tab label="Use Existing Card" id="UseExistingCard"
                                            onactive="{! c.handleActiveTab }">
                                            <div class="slds-form" role="list">
                                                <div class="slds-form__row">
                                                    <div class="slds-size_1-of-2">
                                                        <div class="slds-form__item" role="listitem">
                                                            <div class="slds-form-element slds-form-element_stacked">
                                                                <lightning:combobox label="Select a credit card"
                                                                    aura:id='req-fieldsXC' required="true"
                                                                    value="{!v.selectedCardXC}"
                                                                    placeholder="{! v.placeholderCard }"
                                                                    options="{! v.saveCardsList }"
                                                                    onchange="{! c.validateFormXC }" />

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-form__row">
                                                    <div class="slds-form__item" role="listitem">
                                                        <div class="slds-size_1-of-6">
                                                            <div class="slds-form-element slds-form-element_stacked">
                                                                <lightning:input label="CVC/CVV" aura:id="req-fieldsXC"
                                                                    pattern="[0-9]{3,4}" value="{!v.cvcXC}"
                                                                    onchange="{!c.checkLengthCVC}"
                                                                    fieldLevelHelp="A card's security code, or CVC/CVV, provides an additional level of online fraud protection. The number is located on your credit card and is generally three to four digits long.
                                                                                                 On Vis, Mastercard, and Discover cards, the CVV is a three digit non-embossed number on the back of the card printed within the signature panel after the account number. On American Express cards, it is a four digit-nonembossed number on the face of the card." />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="slds-form__row slds-p-top_small">
                                                    <div class="slds-form__item slds-size_1-of-2" role="listitem">
                                                        <div class="slds-grid slds-wrap slds-m-left_xx-small">
                                                            <ui:inputCheckbox labelClass=" slds-float--right"
                                                                class="slds-col slds-size_1-of-1 slds-cst-cbx_right"
                                                                aura:id="checkbox" value="{!v.SendReceiptToXC}"
                                                                label="Send receipt to (use comma ' , ' to separate multiple emails)"
                                                                change="{!c.checkSendReceiptTo}" />
                                                            <aura:renderIf isTrue="{!v.SendReceiptToXC}">
                                                                <div class="slds-col slds-size_1-of-1">

                                                                    <lightning:input aura:id="emailForm"
                                                                        variant="label-hidden" type="text"
                                                                        value="{!v.addEmailsXC}"
                                                                        onchange="{!c.validateCardEmail}"
                                                                        messageWhenPatternMismatch="Please enter a valid email or valid emails separated by a comma"
                                                                        pattern="^(([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)(\s*,\s*|\s*$))*$"
                                                                        required="true"
                                                                        messageWhenValueMissing="Required Field"
                                                                        maxlength="400" />
                                                                </div>
                                                            </aura:renderIf>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </lightning:tab>
                                        <lightning:tab label="Add New Card" id="AddNewCard"
                                            onactive="{! c.handleActiveTab }">
                                            <div class="slds-form" role="list">
                                                <div class="slds-form__row">
                                                    <div class="slds-form__item" role="listitem">
                                                        <div class="slds-form-element slds-form-element_stacked">
                                                            <lightning:input label="Card Number" name="number"
                                                                pattern="[0-9]{15,16}" aura:id="req-fieldsAC"
                                                                required="true" value="{!v.CardNumber}"
                                                                onchange="{!c.checkLengthCard}"
                                                                messageWhenPatternMismatch="Input a valid 15 or 16 digit card number"
                                                                messageWhenValueMissing="Required Field" />
                                                        </div>
                                                    </div>
                                                    <div class="slds-form__item" role="listitem">
                                                        <div class="slds-form-element slds-form-element_stacked">
                                                            <lightning:input label="Billing Address"
                                                                name="addCardBillingAddress" type="text"
                                                                aura:id='req-fieldsAC' required="true"
                                                                value="{!v.BillingAddress}"
                                                                onchange="{!c.validateFormAC}"
                                                                messageWhenValueMissing="Required Field" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-form__row">
                                                    <div class="slds-form__item" role="listitem">
                                                        <fieldset
                                                            class="slds-form-element slds-form-element_compound slds-form-element_stacked">
                                                            <div class="slds-form-element__row">
                                                                <div class="slds-size_1-of-6" style="width:20%;">
                                                                    <div class="slds-form-element">
                                                                        <lightning:combobox name="month"
                                                                            label="Exp. Month" aura:id="req-fieldsAC"
                                                                            required="true" value="{!v.expiryMonth}"
                                                                            placeholder="MM" class="cst-width"
                                                                            options="{! v.monthList }"
                                                                            onchange="{! c.validateFormAC }"
                                                                            messageWhenValueMissing="Required Field" />
                                                                    </div>
                                                                </div>
                                                                <div class="slds-size_1-of-4">
                                                                    <div class="slds-form-element">
                                                                        <lightning:combobox name="year"
                                                                            dropdownAlignment="right" label="Exp. Year"
                                                                            aura:id='req-fieldsAC' placeholder="YYYY"
                                                                            options="{! v.yearList }"
                                                                            value="{!v.expiryYear}"
                                                                            onchange="{! c.validateFormAC }"
                                                                            required="true"
                                                                            messageWhenValueMissing="Required Field" />
                                                                    </div>
                                                                </div>
                                                                <div class="slds-size_1-of-2 slds-m-left_large"
                                                                    style="width: 30%;">
                                                                    <div class="slds-form-element">
                                                                        <lightning:input label="CVC/CVV"
                                                                            pattern="[0-9]{3,4}" value="{!v.CVCNumber}"
                                                                            onchange="{!c.checkLengthCVC}"
                                                                            messageWhenPatternMismatch="Input a valid CVC/CVV code"
                                                                            fieldLevelHelp="A card's security code, or CVC/CVV, provides an additional level of online fraud protection. The number is located on your credit card and is generally three to four digits long.
                                                                                                         On Vis, Mastercard, and Discover cards, the CVV is a three digit non-embossed number on the back of the card printed within the signature panel after the account number. On American Express cards, it is a four digit-nonembossed number on the face of the card." />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </fieldset>
                                                    </div>
                                                    <div class="slds-form__item" role="listitem">
                                                        <div class="slds-size_1-of-2">
                                                            <div class="slds-form-element slds-form-element_stacked">
                                                                <lightning:input label="Zip/Postal Code"
                                                                    aura:id="req-fieldsAC" required="true"
                                                                    value="{!v.ZipCode}" onchange="{!c.checkLengthZip}"
                                                                    messageWhenValueMissing="Required Field" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-form__row slds-p-top_small">
                                                    <div class="slds-form__item" role="listitem">
                                                        <div class="slds-form-element slds-form-element_stacked">
                                                            <lightning:input label="Cardholder Name"
                                                                name="CcardHolderName" type="text" required="true"
                                                                aura:id="req-fieldsAC" value="{!v.CardHolderName}"
                                                                onchange="{!c.validateFormAC}"
                                                                messageWhenValueMissing="Required Field" />
                                                        </div>
                                                    </div>
                                                    <div class="slds-form__item" role="listitem">
                                                        <div class="slds-form-element slds-form-element_stacked">
                                                            <lightning:input label="Card Nickname"
                                                                name="CcardHolderName" type="text"
                                                                value="{!v.MethodName}" onchange="{!c.validateFormAC}"
                                                                messageWhenValueMissing="Required Field" />
                                                        </div>
                                                    </div>
                                                    <div class="slds-form__item slds-size_1-of-2" role="listitem">
                                                        <div class="slds-grid slds-wrap slds-m-left_xx-small">
                                                            <ui:inputCheckbox labelClass="slds-float--right"
                                                                class="slds-col slds-size_1-of-1 slds-cst-cbx_right"
                                                                aura:id="sendToCheck"
                                                                value="{!v.SendReceiptToAddCard}"
                                                                label="Send receipt to (use comma ' , ' to separate multiple emails)"
                                                                change="{!c.checkSendReceiptTo}" />
                                                            <aura:renderIf isTrue="{!v.SendReceiptToAddCard}">
                                                                <div class="slds-col slds-size_1-of-1">

                                                                    <lightning:input aura:id="emailForm"
                                                                        variant="label-hidden" type="text"
                                                                        value="{!v.addCardEmail}"
                                                                        onchange="{!c.validateAddCardEmail}"
                                                                        messageWhenPatternMismatch="Please enter a valid email or Use commas to separate emails"
                                                                        pattern="^(([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)(\s*,\s*|\s*$))*$"
                                                                        required="true"
                                                                        messageWhenValueMissing="Required Field"
                                                                        maxlength="400" />
                                                                </div>
                                                            </aura:renderIf>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </lightning:tab>
                                    </lightning:tabset>
                                </lightning:tab>

                                <lightning:tab label="Pay by Bank Account" id="PayByACH">
                                    <lightning:tabset variant="scoped" selectedTabId="savedACH">
                                        <lightning:tab label="Use Saved Bank Account" id="savedACH"
                                            onactive="{!c.handleActiveTab}">
                                            <div class="slds-form" role="list">
                                                <div class="slds-form__row ">
                                                    <div class="slds-form__item" role="listitem">
                                                        <div class="slds-form-element slds-form-element_stacked">
                                                            <lightning:combobox label="Select Saved Bank Account"
                                                                aura:id='req-fieldSA' required="true"
                                                                value="{!v.paymentMethodIdSA}"
                                                                placeholder="{! v.placeholderACH }"
                                                                options="{!v.saveACHList }"
                                                                onchange="{! c.validateFormSA }"
                                                                messageWhenValueMissing="Required Field" />
                                                        </div>
                                                    </div>
                                                    <div class="slds-form__item" role="listitem">
                                                        <div class="slds-grid slds-wrap  slds-m-left_xx-small">
                                                            <ui:inputCheckbox labelClass="slds-float--right"
                                                                class="slds-col slds-size_1-of-1 slds-cst-cbx_right"
                                                                aura:id="sendCheckSA" value="{!v.SendReceiptToSA}"
                                                                label="Send receipt to (use comma ' , ' to separate multiple emails)"
                                                                change="{!c.checkSendReceiptToACH}" />
                                                            <aura:renderIf isTrue="{!v.SendReceiptToSA}">
                                                                <div class="slds-col slds-size_1-of-1">
                                                                    <lightning:input aura:id="emailForm"
                                                                        variant="label-hidden" type="text"
                                                                        style="margin-bottom: 23px;"
                                                                        value="{!v.addEmailsSA}"
                                                                        onchange="{!c.validateBankEmail}"
                                                                        messageWhenPatternMismatch="Please enter a valid email or valid emails separated by a comma"
                                                                        pattern="^(([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)(\s*,\s*|\s*$))*$"
                                                                        required="true"
                                                                        messageWhenValueMissing="Required Field" />
                                                                </div>
                                                            </aura:renderIf>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </lightning:tab>
                                        <lightning:tab label="Add New Bank Account" id="addNewACH"
                                            onactive="{!c.handleActiveTab}">
                                            <div class="slds-form" role="list">
                                                <div class="slds-form__row">
                                                    <div class="slds-form__item" role="listitem">
                                                        <div class="slds-form-element slds-form-element_stacked">
                                                            <lightning:input name="acctHolderName" type="text"
                                                                label="Account Holder Name" aura:id='req-fields'
                                                                required="true" value="{!v.accHolderName}"
                                                                onchange="{!c.validateFormACH}"
                                                                messageWhenValueMissing="Required Field" />
                                                        </div>
                                                    </div>
                                                    <div class="slds-form__item" role="listitem">
                                                        <div class="slds-form-element slds-form-element_stacked">
                                                            <lightning:input label="Routing Number" aura:id='req-fields'
                                                                required="true" value="{!v.accRoutNumber}"
                                                                onchange="{!c.checkRoutLength}" pattern="[0-9]{9,9}"
                                                                fieldLevelHelp="9 digit bank routing number"
                                                                messageWhenPatternMismatch="Input numerical values for routing number"
                                                                messageWhenValueMissing="Required Field" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-form__row">
                                                    <div class="slds-form__item" role="listitem">
                                                        <div class="slds-form-element slds-form-element_stacked">
                                                            <lightning:combobox name="acctypes"
                                                                dropdownAlignment="right" label="Account Type"
                                                                aura:id='req-fields' required="true"
                                                                options="{! v.acctypeoptions }" value="{!v.accType}"
                                                                onchange="{! c.validateFormACH }"
                                                                messageWhenValueMissing="Required Field" />
                                                        </div>
                                                    </div>
                                                    <div class="slds-form__item" role="listitem">
                                                        <div class="slds-form-element slds-form-element_stacked">
                                                            <lightning:input label="Account Number" aura:id='req-fields'
                                                                required="true" value="{!v.accNumber}"
                                                                onchange="{!c.validateFormACH}" minlength="9"
                                                                maxlength="16"
                                                                fieldLevelHelp="09 to 16 digit bank account number"
                                                                messageWhenPatternMismatch="Input numerical values for account number"
                                                                messageWhenValueMissing="Required Field" />

                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-form__row">
                                                    <div class="slds-form__item" role="listitem">
                                                        <div
                                                            class="slds-form-element slds-form-element_stacked slds-size_2-of-4">
                                                            <lightning:input label="Account Nickname"
                                                                name="acctHolderName" type="text"
                                                                value="{!v.MethodName}"
                                                                onchange="{!c.validateFormACH}" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-form__row slds-p-top_small">

                                                    <div class="slds-form__item" role="listitem">
                                                        <div class="slds-grid slds-wrap  slds-m-left_xx-small">
                                                            <ui:inputCheckbox labelClass="slds-float--right"
                                                                class="slds-col slds-size_1-of-1 slds-cst-cbx_right"
                                                                aura:id="sendToCheck"
                                                                label="Send receipt to (use comma ' , ' to separate multiple emails)"
                                                                change="{!c.checkSendReceiptToACH}" />
                                                            <aura:renderIf isTrue="{!v.SendReceiptTo}">
                                                                <div class="slds-col slds-size_1-of-1">
                                                                    <lightning:input aura:id="emailForm"
                                                                        variant="label-hidden" type="text"
                                                                        value="{!v.addEmails}"
                                                                        onchange="{!c.validateAddBankEmail}"
                                                                        messageWhenPatternMismatch="Please enter a valid email or valid emails separated by a comma"
                                                                        pattern="^(([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)(\s*,\s*|\s*$))*$"
                                                                        required="true"
                                                                        messageWhenValueMissing="Required Field" />
                                                                </div>
                                                            </aura:renderIf>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </lightning:tab>
                                    </lightning:tabset>
                                </lightning:tab>
                            </lightning:tabset>
                        </div>
                    </div>
    <!--Preview Payment Schedule Modal-->
    <aura:if isTrue="{!v.previewDetails}">
        <!--###### MODAL BOX Start######-->
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
            aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
            <div class="slds-modal__container">
                <!-- ###### MODAL BOX HEADER Start ######-->
                <header class="slds-modal__header">
                    <lightning:buttonIcon iconName="utility:close" onclick="{! c.closeModelPreview }"
                        alternativeText="close" variant="bare-inverse" class="slds-modal__close" />
                    <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Preview of Recurring
                        Schedule
                    </h2>
                </header>
                <!--###### MODAL BOX BODY Part Start######-->
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    <div class="slds-page-header slds-page-header_record-home">
                        <!--Custom Page Header-->
                        <div class="slds-page-header__row ">
                            <div class="slds-page-header__col-title">
                                <div class="slds-media">
                                    <div class="slds-media__figure">
                                        <span class="slds-icon_container slds-icon-standard-avatar">
                                            <lightning:icon iconName="standard:avatar" alternativeText="Orders" />
                                        </span>
                                    </div>
                                    <div class="slds-media__body">
                                        <div class="slds-page-header__name">
                                            <aura:if isTrue="{!v.selectedLookUpAccRecord.ObjectAPIName == 'contact'}">
                                                <div class="slds-page-header__name-title">
                                                    <h1>
                                                        <span>{!v.ConDetail.Email}</span>
                                                        <span
                                                            class="slds-page-header__title slds-truncate">{!v.ConDetail.Name}</span>
                                                    </h1>
                                                </div>
                                                <aura:set attribute="else">
                                                    <aura:if
                                                        isTrue="{!v.selectedLookUpAccRecord.ObjectAPIName == 'custom'}">
                                                        <div class="slds-page-header__name-title">
                                                            <h1>
                                                                <span>{!v.custDetail.Ebiz_C__EBizCharge_Email__c}</span>
                                                                <span
                                                                    class="slds-page-header__title slds-truncate">{!v.custDetail.Name}</span>
                                                            </h1>
                                                        </div>
                                                        <aura:set attribute="else">
                                                            <div class="slds-page-header__name-title">
                                                                <h1>
                                                                    <span>{!v.accDetail.Ebiz_C__EBizCharge_Email__c}</span>
                                                                    <span
                                                                        class="slds-page-header__title slds-truncate">{!v.accDetail.Name}</span>
                                                                </h1>
                                                            </div>
                                                        </aura:set>
                                                    </aura:if>
                                                </aura:set>
                                            </aura:if>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- =========== -->
                        <!--Custom Page Content-->
                        <div class="slds-page-header__row slds-page-header__row_gutters">
                            <div class="slds-page-header__col-details">
                                <div class="slds-page-header__detail-row slds-p-bottom_xxx-small">
                                    <div class="slds-page-header__col-details">
                                        <dl class="slds-list_horizontal slds-wrap">
                                            <dt class="slds-item_label slds-text-color_weak slds-truncate"
                                                title="First Label">Recurring Schedule Name:</dt>
                                            <dd class="slds-item_detail slds-truncate"
                                                title="Description for first label">{!v.NewrrS.rrPayName}</dd>
                                        </dl>
                                    </div>
                                    <div class="slds-page-header__col-details">
                                        <dl class="slds-list_horizontal slds-wrap">
                                            <dt class="slds-item_label slds-text-color_weak slds-truncate"
                                                title="First Label">Payment Frequency:</dt>
                                            <dd class="slds-item_detail slds-truncate"
                                                title="Description for first label">{!v.NewrrS.rrFrequency}</dd>
                                        </dl>
                                    </div>
                                </div>
                                <div class="slds-page-header__detail-row slds-p-vertical_xx-small">
                                    <div class="slds-page-header__col-details">
                                        <dl class="slds-list_horizontal slds-wrap">
                                            <dt class="slds-item_label slds-text-color_weak slds-truncate"
                                                title="First Label">Payment Amount:</dt>
                                            <dd class="slds-item_detail slds-truncate"
                                                title="Description for first label">
                                                <lightning:formattedNumber value="{!''+v.NewrrS.Amount}"
                                                    style="currency" currencyCode="{!v.Settings.Ebiz_C__Currency__c}"
                                                    maximumFractionDigits="2" />
                                            </dd>
                                        </dl>
                                    </div>
                                    <div class="slds-page-header__col-details">
                                        <dl class="slds-list_horizontal slds-wrap">
                                            <dt class="slds-item_label slds-text-color_weak slds-truncate"
                                                title="First Label">Number of Payments:</dt>
                                            <dd class="slds-item_detail slds-truncate"
                                                title="Description for first label">{!v.NewrrS.rrNoOfPays}</dd>
                                        </dl>
                                    </div>
                                </div>
                                <div class="slds-page-header__detail-row slds-p-top_none">
                                    <div class="slds-page-header__col-details">
                                        <dl class="slds-list_horizontal slds-wrap">
                                            <dt class="slds-item_label slds-text-color_weak slds-truncate"
                                                title="First Label">Recurring Duration:</dt>
                                            <dd class="slds-item_detail slds-truncate"
                                                title="Description for first label">
                                                <lightning:formattedDateTime value="{!v.NewrrS.rrStartDate}"
                                                    year="numeric" month="numeric" day="numeric" timeZone="UTC" /> -
                                                <aura:if isTrue="{!v.NewrrS.rrIndefinit}">
                                                    Indefinite
                                                    <aura:set attribute="else">
                                                        <lightning:formattedDateTime value="{!v.NewrrS.rrEndDate}"
                                                            year="numeric" month="numeric" day="numeric"
                                                            timeZone="UTC" />
                                                    </aura:set>
                                                </aura:if>
                                            </dd>
                                        </dl>
                                        {!v.NewrrS.rrScheduledDates}
                                    </div>
                                    <div class="slds-page-header__col-details">
                                        <dl class="slds-list_horizontal slds-wrap">
                                            <dt class="slds-assistive-text" title="First Label">First Label:</dt>
                                            <dd class="slds-assistive-text" title="Description for first label">
                                                Description for first label</dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- =========== -->
                    </div>
                    <div class="slds-m-top_medium">
                    </div>
                </div>
                <!--###### MODAL BOX FOOTER Part Start ######-->
                <footer class="slds-modal__footer">
                    <div class="slds-clearfix">
                        <div class="slds-float_right">
                            <lightning:button class="slds-m-left_x-medium" variant="brand"
                                label="Return to Editing Schedule" title="Return to Editing Schedule"
                                onclick="{! c.closeModelPreview }" />
                            <lightning:button class="slds-m-left_x-medium" variant="brand" label="View Scheduled Dates"
                                title="View Scheduled Dates" onclick="{! c.PreviewScheduleDates }" />
                        </div>
                        <aura:if isTrue="{!v.RecurIndefinitely == false}">
                            <div class="slds-float_right">
                                <div
                                    class="slds-text-heading_medium slds-p-top_xxx-small slds-m-left_xx-small slds-p-right_medium">
                                    <lightning:formattedNumber value="{!v.NewrrS.rrPaysTotal}" style="currency"
                                        currencyCode="{!v.Settings.Ebiz_C__Currency__c}" maximumFractionDigits="2" />
                                </div>
                            </div>
                            <div class="slds-float_right">
                                <div class="slds-text-heading_medium slds-p-top_xxx-small">
                                    Total :
                                </div>
                            </div>
                        </aura:if>
                    </div>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
        <!--###### MODAL BOX Part END Here ######-->
    </aura:if>
    <aura:if isTrue="{!v.isOpenScheduleDatesModal}">
        <!--###### MODAL BOX Start######-->
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
            aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
            <div class="slds-modal__container">
                <!-- ###### MODAL BOX HEADER Start ######-->
                <header class="slds-modal__header">
                    <lightning:buttonIcon iconName="utility:close" onclick="{! c.closeScheduleDatesModel }"
                        alternativeText="close" variant="bare-inverse" class="slds-modal__close" />
                    <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Recurring Scheduled Dates
                    </h2>
                </header>
                <!--###### MODAL BOX BODY Part Start######-->
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    <div class="slds-scrollable slds-grow" style="max-height: 300px">
                        <div class="slds-scrollable_none">
                            <div class="slds-modal__content slds-p-vertical_medium slds-text-align_center">
                                <table aria-multiselectable="false"
                                    class="slds-table slds-table_cell-buffer slds-table_striped slds-table_bordered slds-border_left slds-border_right">
                                    <thead>
                                        <tr class="slds-text-title=caps">
                                            <th scope="col">Payment Number</th>
                                            <th scope="col">Schedule Dates</th>
                                            <th scope="col">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <aura:iteration items="{!v.NewrrS.rrScheduledDates}" var="date"
                                            indexVar="index">
                                            <tr>
                                                <th scope="row">{!index+1}</th>
                                                <th scope="row">
                                                    <lightning:formattedDateTime value="{!date}" year="numeric"
                                                        month="numeric" day="numeric" timeZone="UTC" />
                                                </th>
                                                <th scope="row">
                                                    <lightning:formattedNumber value="{!''+v.rrAmount}" style="currency"
                                                        currencyCode="{!v.Settings.Ebiz_C__Currency__c}"
                                                        maximumFractionDigits="2" />
                                                </th>
                                            </tr>
                                        </aura:iteration>
                                    </tbody>
                                    <aura:if isTrue="{!v.RecurIndefinitely}">
                                        <th scope="row">Recurs Indefinitely....</th>
                                    </aura:if>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!--###### MODAL BOX FOOTER Part Start ######-->
                <footer class="slds-modal__footer">
                    <div class="slds-clearfix">
                        <div class="slds-float_right">
                            <lightning:button class="slds-m-left_x-large" variant="brand"
                                label="Return to Preview Payment Schedule" title="Return to Preview Payment Schedule"
                                onclick="{! c.returnToPreviewPaymentSchedule }" />
                        </div>
                        <aura:if isTrue="{!v.RecurIndefinitely == false}">
                            <div class="slds-float_right">
                                <div class="slds-text-heading_medium slds-p-top_xxx-small slds-m-left_xx-small">
                                    <lightning:formattedNumber value="{!v.NewrrS.rrPaysTotal}" style="currency"
                                        currencyCode="{!v.Settings.Ebiz_C__Currency__c}" maximumFractionDigits="2" />
                                </div>
                            </div>
                            <div class="slds-float_right">
                                <div class="slds-text-heading_medium slds-p-top_xxx-small">
                                    Total :
                                </div>
                            </div>
                        </aura:if>
                    </div>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
        <!--###### MODAL BOX Part END Here ######-->
    </aura:if>
                <!--###### MODAL BOX FOOTER Part Start ######-->
                <footer class="slds-modal__footer">

                    <lightning:button variant="neutral" label="Return to Screen" title="Return to Screen"
                        onclick="{! c.closeModel }" />
                    <lightning:button variant="brand" label="Preview Payment Schedule" disabled="{!v.disableSubmitBtn}"
                        onclick="{! c.PreviewSchedule }" />
                    <lightning:button variant="brand" label="Save Payment Schedule" title="Save Payment Schedule"
                        disabled="{!v.disableSubmitBtn}" onclick="{! c.EditScheduledRR}" />
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </aura:if>
    </div>
    <!-- //###### MODAL BOX Part END Here ###### -->
    <!-- =========== -->
</aura:component>